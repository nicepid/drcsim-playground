{"name":"drcsim-playground","tagline":"Playing around with DRCSim and ROS","body":"# Session 1 - Setup\r\n\r\n## Basics\r\n\r\nTo start with I'm going to assume you're on Ubuntu Desktop 12.04 64-bit - 14.04 should work almost identically if you substitute 'trusty' instead of 'precise' where relevant but I've not tested it.\r\n\r\nMake sure you have up-to-date proprietary drivers installed, and if you're running on a Macbook you're on your own but you'll want to make sure you have that NVidia chipset running instead of the Intel one. When we get to the simulated laser scanner, by default it runs CUDA-accelerated which only works on an NVidia card, so if you have a choice of where you're running this pick a machine with one of those in instead of an AMD card.\r\n\r\nApart from that I'm going to be using Gnome 3, Gnome Terminal, and Vim but you can use whatever you prefer instead. Also, make sure to set your terminal to infinite scrollback because 512 lines is just going to fly by. If you're using Gnome Terminal like me you can go to Edit->Profiles->Edit->Scrolling and tick 'Unlimited'.\r\n\r\nWe're going to be installing some packages from source because DRCSim development moves very fast and this way the versions I'm using will be reproducible for a while.\r\n\r\nOkay, first we're going to install a few basic packages of general utility for development.\r\n\r\n```\r\nsudo apt-get install -y \\\r\n        build-essential \\\r\n        pkg-config      \\\r\n        debhelper       \\\r\n        cmake           \\\r\n        mercurial       \\\r\n        git\r\n```\r\n\r\nNext, here's something I only started doing recently, because anything locally installed from source is usually a huge pain - this lets us install a library `foo` to `~/local/foo` and have it added to all the relevant paths instead of dumping it together with other libraries in a catch-all folder somewhere. Just add this at the end of your `~/.bashrc` using your favourite editor.\r\n\r\n```\r\n# If glob result is empty, give empty result instead of the literal glob\r\nshopt -s nullglob\r\n\r\n# Add subdirectories of any folder in '~/local' to paths\r\nfor dir in $HOME/local/*/; do\r\n  export PATH=\"${dir}bin:$PATH\"\r\n  export LD_LIBRARY_PATH=\"${dir}lib:${dir}lib/x86_64-linux-gnu:$LD_LIBRARY_PATH\"\r\n  export PKG_CONFIG_PATH=\"${dir}lib/pkgconfig:${dir}lib/x86_64-linux-gnu/pkgconfig:$PKG_CONFIG_PATH\"\r\ndone\r\n\r\n# Restore behaviour, so tab-complete works\r\nshopt -u nullglob\r\n```\r\n\r\nLet's make the directories we'll be building in and installing to:\r\n\r\n```\r\nmkdir -p ~/local\r\nmkdir -p ~/src\r\n```\r\n\r\n## Installing Gazebo\r\n\r\nGazebo is a an extendable robot simulator that DRCSim is build on top of - actually DRCSim is mostly a lot of assets and plugins for Gazebo. As a first step we'll build SDFormat which is a library for reading and writing the Simulation Description Format files used by Gazebo.\r\n\r\n### Prerequisites\r\n\r\nThese are the prerequisite libraries for building sdformat and gazebo - a few of these might not be strictly necessary but they won't hurt. Gazebo does have other optional dependencies - for example you can use several other physics engines like SimBody and DART, and you can compile in support for the Oculus Rift. If you're interested in those take a look at the guide [here](http://gazebosim.org/tutorials?tut=install_from_source&ver=4.0&cat=install).\r\n\r\n```\r\nsudo apt-get install -y \\\r\n        avr-libc \\\r\n        freeglut3-dev \\\r\n        gcc-avr \\\r\n        libavcodec-dev \\\r\n        libavformat-dev \\\r\n        libboost-all-dev \\\r\n        libboost-dev \\\r\n        libcegui-mk2-dev \\\r\n        libcurl4-openssl-dev \\\r\n        libfreeimage-dev \\\r\n        libgts-dev \\\r\n        libltdl3-dev \\\r\n        libogre-dev \\\r\n        libopenal-dev \\\r\n        libprotobuf-dev \\\r\n        libprotoc-dev \\\r\n        libqt4-dev \\\r\n        libswscale-dev \\\r\n        libtar-dev \\\r\n        libtbb-dev \\\r\n        libtinyxml-dev \\\r\n        libxml2-dev \\\r\n        mesa-utils \\\r\n        playerc++ \\\r\n        protobuf-compiler \\\r\n        xsltproc\r\n```\r\n\r\n### SDFormat\r\n\r\nWe're going to request a specific tagged revision of SDFormat and specify an install prefix when we build it. After we install we re-source .bashrc to make the installed paths visible for the next step.\r\n\r\n```\r\ncd ~/src\r\nhg clone https://bitbucket.org/osrf/sdformat\r\ncd sdformat\r\nhg up sdf_2.0\r\nmkdir build\r\ncd build\r\ncmake .. -DCMAKE_INSTALL_PREFIX=$HOME/local/sdformat\r\nmake -j4 && make install\r\nsource ~/.bashrc\r\n```\r\n\r\n### Gazebo\r\n\r\nNow for gazebo itself, in much the same way:\r\n\r\n```\r\ncd ~/src\r\nhg clone https://bitbucket.org/osrf/gazebo\r\ncd gazebo\r\nhg up gazebo_4.0\r\n\r\nmkdir build\r\ncd build\r\ncmake .. -DCMAKE_INSTALL_PREFIX=$HOME/local/gazebo\r\nmake -j4 && make install\r\nsource ~/.bashrc\r\n```\r\n\r\nNow we can run Gazebo in with an empty world:\r\n\r\n```\r\nsource local/gazebo/share/gazebo/setup.sh\r\ngazebo\r\n```\r\n\r\n## Installing ROS\r\n\r\nThe next big thing to install is ROS, which stands for Robot Operating System although that's actually a misnomer since ROS runs on top of an operating system and provides a distributed framework for launching and communicating between processes, as well as an ecosystem of tools and libraries for robotics. It's even got its own build system, catkin, that we'll meet shortly.\r\n\r\nFirst we'll add the debian repositories from OSRF that will give us all the library and ROS package dependencies we'll need - I'm not building these from source because there are a lot of them and they're more stable than drcsim and gazebo. I'm using ROS hydro here - the latest release is ROS indigo, and again you should be able to make it work with indigo by simple substitution but I've not tested it.\r\n\r\n```\r\nsudo sh -c 'echo \"deb http://packages.ros.org/ros/ubuntu precise main\" > /etc/apt/sources.list.d/ros-latest.list'\r\nsudo sh -c 'echo \"deb http://packages.osrfoundation.org/drc/ubuntu precise main\" > /etc/apt/sources.list.d/drc-latest.list'\r\n\r\nwget http://packages.ros.org/ros.key -O - | sudo apt-key add -\r\nwget http://packages.osrfoundation.org/drc.key -O - | sudo apt-key add -\r\n\r\nsudo apt-get update\r\n\r\nsudo apt-get install -y \\\r\n        ros-hydro-angles \\\r\n        ros-hydro-cmake-modules \\\r\n        ros-hydro-common-msgs \\\r\n        ros-hydro-compressed-depth-image-transport \\\r\n        ros-hydro-compressed-image-transport \\\r\n        ros-hydro-cv-bridge \\\r\n        ros-hydro-driver-base \\\r\n        ros-hydro-dynamic-reconfigure \\\r\n        ros-hydro-geometry \\\r\n        ros-hydro-geometry-experimental \\\r\n        ros-hydro-geometry-msgs \\\r\n        ros-hydro-image-common \\\r\n        ros-hydro-image-pipeline \\\r\n        ros-hydro-image-transport \\\r\n        ros-hydro-image-transport-plugins \\\r\n        ros-hydro-joint-limits-interface \\\r\n        ros-hydro-laser-assembler \\\r\n        ros-hydro-message-generation \\\r\n        ros-hydro-moveit-msgs \\\r\n        ros-hydro-nav-msgs \\\r\n        ros-hydro-nodelet \\\r\n        ros-hydro-opencv2 \\\r\n        ros-hydro-pcl-conversions \\\r\n        ros-hydro-pcl-ros \\\r\n        ros-hydro-polled-camera \\\r\n        ros-hydro-pr2-controllers \\\r\n        ros-hydro-robot-state-publisher \\\r\n        ros-hydro-ros \\\r\n        ros-hydro-ros-comm \\\r\n        ros-hydro-ros-controllers \\\r\n        ros-hydro-rosconsole \\\r\n        ros-hydro-rosgraph-msgs \\\r\n        ros-hydro-sensor-msgs \\\r\n        ros-hydro-std-msgs \\\r\n        ros-hydro-tf \\\r\n        ros-hydro-theora-image-transport \\\r\n        ros-hydro-trajectory-msgs \\\r\n        ros-hydro-transmission-interface \\\r\n        ros-hydro-urdf \\\r\n        ros-hydro-xacro\r\n```\r\n\r\nIf you get an error saying 'file already exists' running this next command, that's fine. If you get a python error, try: `sudo pip install rosdep` and then re-run the commands.\r\n\r\n```\r\nsudo rosdep init\r\nrosdep update\r\n```\r\n\r\nWe're also going to install some optional tools for managing a workspace with multiple external ROS repositories:\r\n\r\n```\r\nsudo apt-get install python-wstool python-rosinstall\r\n```\r\n\r\n## Installing DRCSim\r\n\r\nFor now, we're going to manually source our ROS environment.\r\n\r\n```\r\nsource /opt/ros/hydro/setup.bash\r\n```\r\n\r\nWe're going to start working with the catkin build system and related tools. It's build on top of CMake and has some wrapper macros and commands - if you know CMake, the output should look pretty familiar once we start building.\r\n\r\nA lot of what catkin does related to ROS packages - packages can be found by name by searching the `$ROS_PACKAGE_PATH` environment variable, and workspaces contain `setup.sh` or `setup.bash` files that set up environment variables including `$ROS_PACKAGE_PATH`.\r\n\r\nWe're going to create a new workspace - since we've already sourced the ros hydro setup file, it'll be overlayed on top of the base ros hydro workspace.\r\n\r\n\r\n\r\n```\r\nsource /opt/ros/hydro/setup.bash\r\nmkdir -p ~/drcsim_ws/src\r\ncd ~/drcsim_ws/src\r\n\r\ncatkin_init_workspace\r\n```\r\n\r\nOnce we build and install some packages, there will be `devel/`, `build/` and `install/` folders alongside the `src/` in our catkin workspace. `build/` will contain intermediate files from the build, `devel/` will contain built targets and `install/` will only contain targets and files that are explicitly installed.\r\n\r\nNow let's add some remote repositories and request specific tagged revisions of each one. The drcsim repo might take a while so be patient.\r\n\r\n```\r\nwstool init\r\n\r\nwstool set gazebo_ros_pkgs -y --git https://github.com/ros-simulation/gazebo_ros_pkgs.git --version=2.3.8\r\nwstool set osrf_common -y --hg https://bitbucket.org/osrf/osrf-common --version=osrf-common_1.1.0\r\nwstool set sandia_hand -y --hg https://bitbucket.org/osrf/sandia-hand --version=sandia-hand_5.3.0\r\nwstool set drcsim -y --hg https://bitbucket.org/osrf/drcsim --version=drcsim_4.2.1\r\n\r\nwstool update\r\n```\r\n\r\nIt's finally time to build DRCSim:\r\n\r\n```\r\ncd ..\r\n\r\ncatkin_make\r\n\r\ncatkin_make install\r\n```\r\n\r\nAnd now to test, we're going to add the `setup.sh` for the installed drcsim to our `~/.bashrc` using our favourite editor. It's probably best to add it *before* the stuff we added earlier, although it shouldn't matter for the paths we're using right now.\r\n\r\n```\r\nsource $HOME/drcsim_ws/install/share/drcsim/setup.sh\r\n```\r\n\r\nNow you can finally see Atlas in Gazebo:\r\n\r\n```\r\nsource ~/.bashrc\r\nroslaunch drcsim_gazebo atlas.launch\r\n```\r\n\r\nThat's all for this first part. Next time we'll look at some of the other tools that ROS provides, and make Atlas move!","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}